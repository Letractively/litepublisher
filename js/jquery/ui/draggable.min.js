(function(d){"function"===typeof define&&define.amd?define(["jquery","./core","./mouse","./widget"],d):d(jQuery)})(function(d){d.widget("ui.draggable",d.ui.mouse,{version:"1.11.1",widgetEventPrefix:"drag",options:{addClasses:!0,appendTo:"parent",axis:!1,connectToSortable:!1,containment:!1,cursor:"auto",cursorAt:!1,grid:!1,handle:!1,helper:"original",iframeFix:!1,opacity:!1,refreshPositions:!1,revert:!1,revertDuration:500,scope:"default",scroll:!0,scrollSensitivity:20,scrollSpeed:20,snap:!1,snapMode:"both",
snapTolerance:20,stack:!1,zIndex:!1,drag:null,start:null,stop:null},_create:function(){"original"!==this.options.helper||/^(?:r|a|f)/.test(this.element.css("position"))||(this.element[0].style.position="relative");this.options.addClasses&&this.element.addClass("ui-draggable");this.options.disabled&&this.element.addClass("ui-draggable-disabled");this._setHandleClassName();this._mouseInit()},_setOption:function(b,c){this._super(b,c);"handle"===b&&(this._removeHandleClassName(),this._setHandleClassName())},
_destroy:function(){(this.helper||this.element).is(".ui-draggable-dragging")?this.destroyOnClear=!0:(this.element.removeClass("ui-draggable ui-draggable-dragging ui-draggable-disabled"),this._removeHandleClassName(),this._mouseDestroy())},_mouseCapture:function(b){var c=this.document[0],a=this.options;try{c.activeElement&&"body"!==c.activeElement.nodeName.toLowerCase()&&d(c.activeElement).blur()}catch(g){}if(this.helper||a.disabled||0<d(b.target).closest(".ui-resizable-handle").length)return!1;this.handle=
this._getHandle(b);if(!this.handle)return!1;d(!0===a.iframeFix?"iframe":a.iframeFix).each(function(){d("<div class='ui-draggable-iframeFix' style='background: #fff;'></div>").css({width:this.offsetWidth+"px",height:this.offsetHeight+"px",position:"absolute",opacity:"0.001",zIndex:1E3}).css(d(this).offset()).appendTo("body")});return!0},_mouseStart:function(b){var c=this.options;this.helper=this._createHelper(b);this.helper.addClass("ui-draggable-dragging");this._cacheHelperProportions();d.ui.ddmanager&&
(d.ui.ddmanager.current=this);this._cacheMargins();this.cssPosition=this.helper.css("position");this.scrollParent=this.helper.scrollParent(!0);this.offsetParent=this.helper.offsetParent();this.offsetParentCssPosition=this.offsetParent.css("position");this.offset=this.positionAbs=this.element.offset();this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left};this.offset.scroll=!1;d.extend(this.offset,{click:{left:b.pageX-this.offset.left,top:b.pageY-this.offset.top},
parent:this._getParentOffset(),relative:this._getRelativeOffset()});this.originalPosition=this.position=this._generatePosition(b,!1);this.originalPageX=b.pageX;this.originalPageY=b.pageY;c.cursorAt&&this._adjustOffsetFromHelper(c.cursorAt);this._setContainment();if(!1===this._trigger("start",b))return this._clear(),!1;this._cacheHelperProportions();d.ui.ddmanager&&!c.dropBehaviour&&d.ui.ddmanager.prepareOffsets(this,b);this._mouseDrag(b,!0);d.ui.ddmanager&&d.ui.ddmanager.dragStart(this,b);return!0},
_mouseDrag:function(b,c){"fixed"===this.offsetParentCssPosition&&(this.offset.parent=this._getParentOffset());this.position=this._generatePosition(b,!0);this.positionAbs=this._convertPositionTo("absolute");if(!c){var a=this._uiHash();if(!1===this._trigger("drag",b,a))return this._mouseUp({}),!1;this.position=a.position}this.helper[0].style.left=this.position.left+"px";this.helper[0].style.top=this.position.top+"px";d.ui.ddmanager&&d.ui.ddmanager.drag(this,b);return!1},_mouseStop:function(b){var c=
this,a=!1;d.ui.ddmanager&&!this.options.dropBehaviour&&(a=d.ui.ddmanager.drop(this,b));this.dropped&&(a=this.dropped,this.dropped=!1);"invalid"===this.options.revert&&!a||"valid"===this.options.revert&&a||!0===this.options.revert||d.isFunction(this.options.revert)&&this.options.revert.call(this.element,a)?d(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){!1!==c._trigger("stop",b)&&c._clear()}):!1!==this._trigger("stop",b)&&this._clear();return!1},_mouseUp:function(b){d("div.ui-draggable-iframeFix").each(function(){this.parentNode.removeChild(this)});
d.ui.ddmanager&&d.ui.ddmanager.dragStop(this,b);this.element.focus();return d.ui.mouse.prototype._mouseUp.call(this,b)},cancel:function(){this.helper.is(".ui-draggable-dragging")?this._mouseUp({}):this._clear();return this},_getHandle:function(b){return this.options.handle?!!d(b.target).closest(this.element.find(this.options.handle)).length:!0},_setHandleClassName:function(){this.handleElement=this.options.handle?this.element.find(this.options.handle):this.element;this.handleElement.addClass("ui-draggable-handle")},
_removeHandleClassName:function(){this.handleElement.removeClass("ui-draggable-handle")},_createHelper:function(b){var c=this.options;b=d.isFunction(c.helper)?d(c.helper.apply(this.element[0],[b])):"clone"===c.helper?this.element.clone().removeAttr("id"):this.element;b.parents("body").length||b.appendTo("parent"===c.appendTo?this.element[0].parentNode:c.appendTo);b[0]===this.element[0]||/(fixed|absolute)/.test(b.css("position"))||b.css("position","absolute");return b},_adjustOffsetFromHelper:function(b){"string"===
typeof b&&(b=b.split(" "));d.isArray(b)&&(b={left:+b[0],top:+b[1]||0});"left"in b&&(this.offset.click.left=b.left+this.margins.left);"right"in b&&(this.offset.click.left=this.helperProportions.width-b.right+this.margins.left);"top"in b&&(this.offset.click.top=b.top+this.margins.top);"bottom"in b&&(this.offset.click.top=this.helperProportions.height-b.bottom+this.margins.top)},_isRootNode:function(b){return/(html|body)/i.test(b.tagName)||b===this.document[0]},_getParentOffset:function(){var b=this.offsetParent.offset(),
c=this.document[0];"absolute"===this.cssPosition&&this.scrollParent[0]!==c&&d.contains(this.scrollParent[0],this.offsetParent[0])&&(b.left+=this.scrollParent.scrollLeft(),b.top+=this.scrollParent.scrollTop());this._isRootNode(this.offsetParent[0])&&(b={top:0,left:0});return{top:b.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:b.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"!==this.cssPosition)return{top:0,left:0};var b=
this.element.position(),c=this._isRootNode(this.scrollParent[0]);return{top:b.top-(parseInt(this.helper.css("top"),10)||0)+(c?0:this.scrollParent.scrollTop()),left:b.left-(parseInt(this.helper.css("left"),10)||0)+(c?0:this.scrollParent.scrollLeft())}},_cacheMargins:function(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0,right:parseInt(this.element.css("marginRight"),10)||0,bottom:parseInt(this.element.css("marginBottom"),10)||
0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var b,c,a;b=this.options;c=this.document[0];this.relativeContainer=null;if(b.containment)if("window"===b.containment)this.containment=[d(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,d(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,d(window).scrollLeft()+d(window).width()-this.helperProportions.width-
this.margins.left,d(window).scrollTop()+(d(window).height()||c.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top];else if("document"===b.containment)this.containment=[0,0,d(c).width()-this.helperProportions.width-this.margins.left,(d(c).height()||c.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top];else if(b.containment.constructor===Array)this.containment=b.containment;else{if("parent"===b.containment&&(b.containment=this.helper[0].parentNode),
c=d(b.containment),a=c[0])b="hidden"!==c.css("overflow"),this.containment=[(parseInt(c.css("borderLeftWidth"),10)||0)+(parseInt(c.css("paddingLeft"),10)||0),(parseInt(c.css("borderTopWidth"),10)||0)+(parseInt(c.css("paddingTop"),10)||0),(b?Math.max(a.scrollWidth,a.offsetWidth):a.offsetWidth)-(parseInt(c.css("borderRightWidth"),10)||0)-(parseInt(c.css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(b?Math.max(a.scrollHeight,a.offsetHeight):a.offsetHeight)-
(parseInt(c.css("borderBottomWidth"),10)||0)-(parseInt(c.css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom],this.relativeContainer=c}else this.containment=null},_convertPositionTo:function(b,c){c||(c=this.position);var a="absolute"===b?1:-1,d=this._isRootNode(this.scrollParent[0]);return{top:c.top+this.offset.relative.top*a+this.offset.parent.top*a-("fixed"===this.cssPosition?-this.offset.scroll.top:d?0:this.offset.scroll.top)*a,left:c.left+this.offset.relative.left*
a+this.offset.parent.left*a-("fixed"===this.cssPosition?-this.offset.scroll.left:d?0:this.offset.scroll.left)*a}},_generatePosition:function(b,c){var a,d,e,f=this.options,l=this._isRootNode(this.scrollParent[0]);e=b.pageX;d=b.pageY;l&&this.offset.scroll||(this.offset.scroll={top:this.scrollParent.scrollTop(),left:this.scrollParent.scrollLeft()});c&&(this.containment&&(this.relativeContainer?(a=this.relativeContainer.offset(),a=[this.containment[0]+a.left,this.containment[1]+a.top,this.containment[2]+
a.left,this.containment[3]+a.top]):a=this.containment,b.pageX-this.offset.click.left<a[0]&&(e=a[0]+this.offset.click.left),b.pageY-this.offset.click.top<a[1]&&(d=a[1]+this.offset.click.top),b.pageX-this.offset.click.left>a[2]&&(e=a[2]+this.offset.click.left),b.pageY-this.offset.click.top>a[3]&&(d=a[3]+this.offset.click.top)),f.grid&&(d=f.grid[1]?this.originalPageY+Math.round((d-this.originalPageY)/f.grid[1])*f.grid[1]:this.originalPageY,d=a?d-this.offset.click.top>=a[1]||d-this.offset.click.top>a[3]?
d:d-this.offset.click.top>=a[1]?d-f.grid[1]:d+f.grid[1]:d,e=f.grid[0]?this.originalPageX+Math.round((e-this.originalPageX)/f.grid[0])*f.grid[0]:this.originalPageX,e=a?e-this.offset.click.left>=a[0]||e-this.offset.click.left>a[2]?e:e-this.offset.click.left>=a[0]?e-f.grid[0]:e+f.grid[0]:e),"y"===f.axis&&(e=this.originalPageX),"x"===f.axis&&(d=this.originalPageY));return{top:d-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.offset.scroll.top:l?
0:this.offset.scroll.top),left:e-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.offset.scroll.left:l?0:this.offset.scroll.left)}},_clear:function(){this.helper.removeClass("ui-draggable-dragging");this.helper[0]===this.element[0]||this.cancelHelperRemoval||this.helper.remove();this.helper=null;this.cancelHelperRemoval=!1;this.destroyOnClear&&this.destroy()},_trigger:function(b,c,a){a=a||this._uiHash();d.ui.plugin.call(this,b,[c,a,this],!0);
"drag"===b&&(this.positionAbs=this._convertPositionTo("absolute"));return d.Widget.prototype._trigger.call(this,b,c,a)},plugins:{},_uiHash:function(){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}});d.ui.plugin.add("draggable","connectToSortable",{start:function(b,c,a){var g=a.options,e=d.extend({},c,{item:a.element});a.sortables=[];d(g.connectToSortable).each(function(){var c=d(this).sortable("instance");c&&!c.options.disabled&&(a.sortables.push({instance:c,
shouldRevert:c.options.revert}),c.refreshPositions(),c._trigger("activate",b,e))})},stop:function(b,c,a){var g=d.extend({},c,{item:a.element});d.each(a.sortables,function(){this.instance.isOver?(this.instance.isOver=0,a.cancelHelperRemoval=!0,this.instance.cancelHelperRemoval=!1,this.shouldRevert&&(this.instance.options.revert=this.shouldRevert),this.instance._mouseStop(b),this.instance.options.helper=this.instance.options._helper,"original"===a.options.helper&&this.instance.currentItem.css({top:"auto",
left:"auto"})):(this.instance.cancelHelperRemoval=!1,this.instance._trigger("deactivate",b,g))})},drag:function(b,c,a){var g=this;d.each(a.sortables,function(){var e=!1,f=this;this.instance.positionAbs=a.positionAbs;this.instance.helperProportions=a.helperProportions;this.instance.offset.click=a.offset.click;this.instance._intersectsWith(this.instance.containerCache)&&(e=!0,d.each(a.sortables,function(){this.instance.positionAbs=a.positionAbs;this.instance.helperProportions=a.helperProportions;this.instance.offset.click=
a.offset.click;this!==f&&this.instance._intersectsWith(this.instance.containerCache)&&d.contains(f.instance.element[0],this.instance.element[0])&&(e=!1);return e}));e?(this.instance.isOver||(this.instance.isOver=1,this.instance.currentItem=d(g).clone().removeAttr("id").appendTo(this.instance.element).data("ui-sortable-item",!0),this.instance.options._helper=this.instance.options.helper,this.instance.options.helper=function(){return c.helper[0]},b.target=this.instance.currentItem[0],this.instance._mouseCapture(b,
!0),this.instance._mouseStart(b,!0,!0),this.instance.offset.click.top=a.offset.click.top,this.instance.offset.click.left=a.offset.click.left,this.instance.offset.parent.left-=a.offset.parent.left-this.instance.offset.parent.left,this.instance.offset.parent.top-=a.offset.parent.top-this.instance.offset.parent.top,a._trigger("toSortable",b),a.dropped=this.instance.element,a.currentItem=a.element,this.instance.fromOutside=a),this.instance.currentItem&&this.instance._mouseDrag(b)):this.instance.isOver&&
(this.instance.isOver=0,this.instance.cancelHelperRemoval=!0,this.instance.options.revert=!1,this.instance._trigger("out",b,this.instance._uiHash(this.instance)),this.instance._mouseStop(b,!0),this.instance.options.helper=this.instance.options._helper,this.instance.currentItem.remove(),this.instance.placeholder&&this.instance.placeholder.remove(),a._trigger("fromSortable",b),a.dropped=!1)})}});d.ui.plugin.add("draggable","cursor",{start:function(b,c,a){b=d("body");a=a.options;b.css("cursor")&&(a._cursor=
b.css("cursor"));b.css("cursor",a.cursor)},stop:function(b,c,a){b=a.options;b._cursor&&d("body").css("cursor",b._cursor)}});d.ui.plugin.add("draggable","opacity",{start:function(b,c,a){b=d(c.helper);a=a.options;b.css("opacity")&&(a._opacity=b.css("opacity"));b.css("opacity",a.opacity)},stop:function(b,c,a){b=a.options;b._opacity&&d(c.helper).css("opacity",b._opacity)}});d.ui.plugin.add("draggable","scroll",{start:function(b,c,a){a.scrollParentNotHidden||(a.scrollParentNotHidden=a.helper.scrollParent(!1));
a.scrollParentNotHidden[0]!==a.document[0]&&"HTML"!==a.scrollParentNotHidden[0].tagName&&(a.overflowOffset=a.scrollParentNotHidden.offset())},drag:function(b,c,a){c=a.options;var g=!1,e=a.scrollParentNotHidden[0],f=a.document[0];e!==f&&"HTML"!==e.tagName?(c.axis&&"x"===c.axis||(a.overflowOffset.top+e.offsetHeight-b.pageY<c.scrollSensitivity?e.scrollTop=g=e.scrollTop+c.scrollSpeed:b.pageY-a.overflowOffset.top<c.scrollSensitivity&&(e.scrollTop=g=e.scrollTop-c.scrollSpeed)),c.axis&&"y"===c.axis||(a.overflowOffset.left+
e.offsetWidth-b.pageX<c.scrollSensitivity?e.scrollLeft=g=e.scrollLeft+c.scrollSpeed:b.pageX-a.overflowOffset.left<c.scrollSensitivity&&(e.scrollLeft=g=e.scrollLeft-c.scrollSpeed))):(c.axis&&"x"===c.axis||(b.pageY-d(f).scrollTop()<c.scrollSensitivity?g=d(f).scrollTop(d(f).scrollTop()-c.scrollSpeed):d(window).height()-(b.pageY-d(f).scrollTop())<c.scrollSensitivity&&(g=d(f).scrollTop(d(f).scrollTop()+c.scrollSpeed))),c.axis&&"y"===c.axis||(b.pageX-d(f).scrollLeft()<c.scrollSensitivity?g=d(f).scrollLeft(d(f).scrollLeft()-
c.scrollSpeed):d(window).width()-(b.pageX-d(f).scrollLeft())<c.scrollSensitivity&&(g=d(f).scrollLeft(d(f).scrollLeft()+c.scrollSpeed))));!1!==g&&d.ui.ddmanager&&!c.dropBehaviour&&d.ui.ddmanager.prepareOffsets(a,b)}});d.ui.plugin.add("draggable","snap",{start:function(b,c,a){b=a.options;a.snapElements=[];d(b.snap.constructor!==String?b.snap.items||":data(ui-draggable)":b.snap).each(function(){var b=d(this),c=b.offset();this!==a.element[0]&&a.snapElements.push({item:this,width:b.outerWidth(),height:b.outerHeight(),
top:c.top,left:c.left})})},drag:function(b,c,a){var g,e,f,l,m,p,n,q,h,t,u=a.options,k=u.snapTolerance,r=c.offset.left,v=r+a.helperProportions.width,s=c.offset.top,w=s+a.helperProportions.height;for(h=a.snapElements.length-1;0<=h;h--)m=a.snapElements[h].left,p=m+a.snapElements[h].width,n=a.snapElements[h].top,q=n+a.snapElements[h].height,v<m-k||r>p+k||w<n-k||s>q+k||!d.contains(a.snapElements[h].item.ownerDocument,a.snapElements[h].item)?(a.snapElements[h].snapping&&a.options.snap.release&&a.options.snap.release.call(a.element,
b,d.extend(a._uiHash(),{snapItem:a.snapElements[h].item})),a.snapElements[h].snapping=!1):("inner"!==u.snapMode&&(g=Math.abs(n-w)<=k,e=Math.abs(q-s)<=k,f=Math.abs(m-v)<=k,l=Math.abs(p-r)<=k,g&&(c.position.top=a._convertPositionTo("relative",{top:n-a.helperProportions.height,left:0}).top-a.margins.top),e&&(c.position.top=a._convertPositionTo("relative",{top:q,left:0}).top-a.margins.top),f&&(c.position.left=a._convertPositionTo("relative",{top:0,left:m-a.helperProportions.width}).left-a.margins.left),
l&&(c.position.left=a._convertPositionTo("relative",{top:0,left:p}).left-a.margins.left)),t=g||e||f||l,"outer"!==u.snapMode&&(g=Math.abs(n-s)<=k,e=Math.abs(q-w)<=k,f=Math.abs(m-r)<=k,l=Math.abs(p-v)<=k,g&&(c.position.top=a._convertPositionTo("relative",{top:n,left:0}).top-a.margins.top),e&&(c.position.top=a._convertPositionTo("relative",{top:q-a.helperProportions.height,left:0}).top-a.margins.top),f&&(c.position.left=a._convertPositionTo("relative",{top:0,left:m}).left-a.margins.left),l&&(c.position.left=
a._convertPositionTo("relative",{top:0,left:p-a.helperProportions.width}).left-a.margins.left)),!a.snapElements[h].snapping&&(g||e||f||l||t)&&a.options.snap.snap&&a.options.snap.snap.call(a.element,b,d.extend(a._uiHash(),{snapItem:a.snapElements[h].item})),a.snapElements[h].snapping=g||e||f||l||t)}});d.ui.plugin.add("draggable","stack",{start:function(b,c,a){var g;b=d.makeArray(d(a.options.stack)).sort(function(a,b){return(parseInt(d(a).css("zIndex"),10)||0)-(parseInt(d(b).css("zIndex"),10)||0)});
b.length&&(g=parseInt(d(b[0]).css("zIndex"),10)||0,d(b).each(function(a){d(this).css("zIndex",g+a)}),this.css("zIndex",g+b.length))}});d.ui.plugin.add("draggable","zIndex",{start:function(b,c,a){b=d(c.helper);a=a.options;b.css("zIndex")&&(a._zIndex=b.css("zIndex"));b.css("zIndex",a.zIndex)},stop:function(b,c,a){b=a.options;b._zIndex&&d(c.helper).css("zIndex",b._zIndex)}});return d.ui.draggable});
