(function(b,p,m){b.fn.popimage=function(g){g=b.extend({title:"",cursorclass:"cursor-loading",width:!1,height:!1},g);var h=!1,n=/\.(jpg|jpeg|png|bmp)$/i,q,r;return this.each(function(){var k=b(this),l=k.attr("href");if(!l||!n.test(l))if(l=k.data("image"),!l||!n.test(l))return;k.data("image",l);h&&(k.data("prevlink",h),h.data("nextlink",k));h=k;k.one("mouseenter.popinit focus.popinit click.popinit",function(h){var a=b(this);a.off(".popinit");a.addClass(g.cursorclass);if(n.test(a.attr("href")))var s=
" click";else{if("click"==h.type)return;s=""}a.data("focused",h.type).on(("mouseenter"==h.type?"mouseleave":"blur")+".popinit",function(){b(this).data("focused",!1).off(".popinit")});var e=new Image;e.onload=function(){a.removeClass(g.cursorclass);var f=e.width/e.height;if(g.width)var c=g.width,d=g.height;else 1<=f?(d=p.innerHeight||m.documentElement.clientHeight||m.body.clientHeight,d=Math.floor(d/2)-20,c=Math.floor(4*d/3)):(c=p.innerWidth||m.documentElement.clientWidth||m.body.clientWidth,c=Math.floor(c/
2)-20,d=Math.floor(c/4*3));e.width<=c&&e.height<=d?(c=e.width,d=e.height):c/d>f?c=Math.floor(d*f):d=Math.floor(c/f);var b=a.attr("title");n.test(b)&&(b=g.title);a.popover({container:"body",content:'<img src="'+l+'" width="'+c+'" height="'+d+'" />',delay:120,html:!0,placement:"auto "+(1<=f?"bottom":"right"),template:'<div class="popover popover-image"><div class="arrow"></div><h3 class="popover-title" style="max-width:'+c+'px;"></h3><div class="popover-content"></div></div>',title:b,trigger:"hover focus"+
s});a.data("focused")&&a.trigger(a.data("focused"));if(f=a.data("nextlink"))q=new Image,q.src=f.data("image");if(f=k.data("prevlink"))r=new Image,r.src=f.data("image");litepubl.stat("popimage",{src:a.data("image")})};e.onerror=function(){};e.src=a.data("image");return!1})})};b.ready2(function(){"popover"in b.fn&&b("a.photo").popimage()})})(jQuery,window,document);
