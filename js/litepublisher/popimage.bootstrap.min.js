(function(k,p,m){k.fn.popimage=function(g){g=k.extend({title:"",cursorclass:"cursor-loading",width:!1,height:!1},g);var b=!1,n=/\.(jpg|jpeg|png|bmp)$/i,q,r;return this.each(function(){var h=k(this),l=h.attr("href");if(!l||!n.test(l))if(l=h.data("image"),!l||!n.test(l))return;h.data("image",l);b&&(h.data("prevlink",b),b.data("nextlink",h));b=h;h.one("mouseenter.popinit focus.popinit click.popinit",function(b){var a=k(this);a.off(".popinit");a.addClass(g.cursorclass);if(n.test(a.attr("href")))var s=
" click";else{if("click"==b.type)return;s=""}a.data("focused",b.type).on(("mouseenter"==b.type?"mouseleave":"blur")+".popinit",function(){k(this).data("focused",!1).off(".popinit")});var e=new Image;e.onload=function(){a.removeClass(g.cursorclass);var f=e.width/e.height;if(g.width)var c=g.width,d=g.height;else 1<=f?(d=p.innerHeight||m.documentElement.clientHeight||m.body.clientHeight,d=Math.floor(d/2)-20,c=Math.floor(4*d/3)):(c=p.innerWidth||m.documentElement.clientWidth||m.body.clientWidth,c=Math.floor(c/
2)-20,d=Math.floor(c/4*3));e.width<=c&&e.height<=d?(c=e.width,d=e.height):c/d>f?c=Math.floor(d*f):d=Math.floor(c/f);var b=a.attr("title");n.test(b)&&(b=g.title);a.popover({container:"body",content:'<img src="'+l+'" width="'+c+'" height="'+d+'" />',delay:120,html:!0,placement:"auto "+(1<=f?"bottom":"right"),template:'<div class="popover popover-image"><div class="arrow"></div><h3 class="popover-title" style="max-width:'+c+'px;"></h3><div class="popover-content"></div></div>',title:b,trigger:"hover focus"+
s});a.data("focused")&&a.trigger(a.data("focused"));if(f=a.data("nextlink"))q=new Image,q.src=f.data("image");if(f=h.data("prevlink"))r=new Image,r.src=f.data("image");litepubl.stat("popimage",{src:a.data("image")})};e.onerror=function(){};e.src=a.data("image");return!1})})};ready2(function(){"popover"in k.fn&&k("a.photo").popimage()})})(jQuery,window,document);
