(function(f,p,q){f.fn.popimage=function(b){b=f.extend({title:"Image",cursorclass:"cursor-loading",width:40,height:30},b);var h=!1,m=/\.(jpg|jpeg|png|bmp)$/;return this.each(function(){var k=f(this);h&&(k.data("prevlink",h),h.data("nextlink",k));h=k;k.one("mouseenter.popinit focus.popinit click.popinit",function(h){var d=f(this);d.off(".popinit");d.addClass(b.cursorclass);var l=d.attr("href");if(m.test(l))var n=" click";else{if("click"==h.type)return;n="";l=d.data("image")}var e=new Image;e.onload=
function(){d.removeClass(b.cursorclass);if(100>b.width)var a=Math.floor(f(p).width()*b.width/100),g=Math.floor(a*b.height/b.width);else a=b.width,g=b.height;if(e.width<=a&&e.height<=g)a=e.width,g=e.height;else{var c=e.width/e.height;a/g>c?a=Math.floor(g*c):g=Math.floor(a/c)}c=d.attr("title");m.test(c)&&(c=b.title);14*c.length>a&&(c=c.substring(0,Math.floor(a/14-5))+"...");d.popover({container:"body",content:'<img src="'+l+'" width="'+a+'" height="'+g+'" />',html:!0,placement:"auto bottom",title:c,
trigger:"hover focus"+n});d.popover("show");if(a=d.data("nextlink"))(new Image).src=a.attr("href");if(a=k.data("prevlink"))(new Image).src=a.attr("href")};e.onerror=function(){alert("Error load image")};e.src=l;return!1})})};f(q).ready(function(){f("a.photo").popimage()})})(jQuery,window,document);
