(function(b){b.moderate=function(j){var a={enabled:!0,options:{comments:"#commentlist",hold:"#holdcommentlist",comment:"#comment-",content:"#commentcontent-",buttons:".moderationbuttons",button:'<button type="button">%%title%%</button>',form:"#commentform",editor:"#comment"},setenabled:function(d){d!=this.enabled&&((this.enabled=d)?b(a.options.buttons).show():b(a.options.buttons).hide())},click:function(){if(!a.enabled)return!1;try{var d=b(this),c=d.data("moder"),f=d.data("idcomment");a.setstatus(f,
c)}catch(e){alert("error "+e.message)}return!1},error:function(d){a.setenabled(!0);b.messagebox(lang.dialog.error,d)},setstatus:function(d,c){var f=a.options,e=f.comment+d;switch(c){case "delete":a.setenabled(!1);b.confirmbox(lang.dialog.confirm,lang.comments.confirmdelete,lang.comments.yesdelete,lang.comments.nodelete,function(c){if(0!=c)return a.setenabled(!0);b.litejson({method:"comment_delete",id:d},function(c){if(!1==c)return a.error(lang.comments.notdeleted);b(e).remove();a.setenabled(!0)}).fail(function(){a.error(lang.comments.notdeleted)})});
break;case "hold":case "approved":a.setenabled(!1);b.litejson({method:"comment_setstatus",id:d,status:c},function(e){try{if(!1==e)return a.error(lang.comments.notmoderated);b("hold"==c?f.hold:f.comments).append(b(f.comment+d));a.setenabled(!0)}catch(i){alert("error "+i.message)}}).fail(function(){a.error(lang.comments.notmoderated)});break;case "edit":a.setenabled(!1);b.litejson({method:"comment_getraw",id:d},function(c){var e=b(a.options.editor);e.data("idcomment",d);e.data("savedtext",e.val());
e.val(c.rawcontent);e.focus();b.onEscape(a.restore_submit);var g=b(f.form);g.off("submit.confirmcomment").on("submit.moderate",function(){try{var c=b(f.editor),d=b.trim(c.val());if(""==d)return a.enabled=!0,a.error(lang.comment.emptycontent),a.enabled=!1;b(":input",g).attr("disabled","disabled");b.litejsontype("post",{method:"comment_edit",id:c.data("idcomment"),content:d},function(c){try{b(":input",g).removeAttr("disabled");var d=f.content+c.id;b(d).html(c.content);a.restore_submit();location.hash=
d.substring(1)}catch(e){alert(e.message)}}).fail(function(){b(":input",g).removeAttr("disabled");a.error(lang.comments.notedited);a.restore_submit()})}catch(e){alert(e.message)}return!1})}).fail(function(){a.error(lang.comments.errorrecieved)});break;default:alert("Unknown status "+c)}},restore_submit:function(){var d=b(a.options.editor);d.val(d.data("savedtext"));b(a.options.form).off("submit.moderate");a.setenabled(!0);"confirmcomment"in b&&b.confirmcomment()},loadhold:function(){b(".loadhold").parent().remove();
b.litejson({method:"comments_get_hold",idpost:ltoptions.idpost},function(d){try{var c=a.options;if(c.ismoder){for(var f=b(c.comments),e=b(c.hold);f.next()[0]!=e[0];)f.next().remove();e.remove()}b(c.comments).after(d.items);a.create_buttons(c.hold)}catch(h){alert("error "+h.message)}}).fail(function(){a.error(lang.comments.errorrecieved)});return!1},create_buttons:function(d){var c=a.options,f=c.button.replace("%%title%%",lang.comments.approve),e=c.button.replace("%%title%%",lang.comments.hold),h=
c.button.replace("%%title%%",lang.comments.del),i=c.button.replace("%%title%%",lang.comments.edit),g=a.click,j=get_cookie("litepubl_user_id");b(c.buttons,d).each(function(){var a=b(this),d=a.data("idcomment");if(c.ismoder){if(b(f).appendTo(a).data("idcomment",d).data("moder","approved").click(g),b(e).appendTo(a).data("idcomment",d).data("moder","hold").click(g),b(h).appendTo(a).data("idcomment",d).data("moder","delete").click(g),b(i).appendTo(a).data("idcomment",d).data("moder","edit").click(g),a.is(":hidden"))b('<button type="button">E</button>').insertBefore(a).one("click",
function(){b(this).next().show();b(this).remove();return!1})}else if(a.data("idauthor")==j&&(c.canedit&&b(i).appendTo(a).data("idcomment",d).data("moder","edit").click(g),c.candelete&&b(h).appendTo(a).data("idcomment",d).data("moder","delete").click(g),(c.canedit||c.candelete)&&a.is(":hidden")))b('<button type="button">E</button>').insertBefore(a).one("click",function(){b(this).next().show();b(this).remove();return!1})})}};a.options=b.extend(a.options,ltoptions.theme.comments,j);a.create_buttons(a.options.comments+
", "+a.options.hold);b(".loadhold").click(a.loadhold);return this};b(document).ready(function(){get_cookie("litepubl_user_id")&&b.moderate()})})(jQuery);
