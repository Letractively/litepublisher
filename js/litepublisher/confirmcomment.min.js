(function(b,f,e){e.litepubl.class_confirmcomment=Class.extend({init:function(a){this.options=b.extend({confirmcomment:!0,comuser:!1,form:"#commentform",editor:"#comment"},ltoptions.theme.comments,a);var d=b(this.options.form);this.get("content").off("keydown.confirmcomment").on("keydown.confirmcomment",function(a){a.ctrlKey&&(13==a.keyCode||10==a.keyCode)&&d.submit()});var c=this;d.off("submit.confirmcomment").on("submit.confirmcomment",function(){return c.submit()})},get:function(a){return"content"==
a?b("textarea[name='content']",this.options.form):b("input[name='"+a+"']",this.options.form)},error:function(a){return b.messagebox(lang.dialog.error,a)},error_field:function(a,b){var c=this;this.error(b).close=function(){c.get(a).focus()}},empty:function(a){a=this.get(a).val();return""==b.trim(a)},validemail:function(){var a=b.trim(this.get("email").val());return""==a?!1:/^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/.test(a)},validate:function(){if(""==b.trim(this.get("content").val()))return this.error_field("content",
lang.comment.emptycontent),!1;if(!this.options.comuser)return!0;if(this.empty("name"))this.error_field("name",lang.comment.emptyname);else{if(this.validemail())return!0;this.error_field("email",lang.comment.invalidemail)}return!1},send:function(){var a={method:"comment_add"},d=b(":input",this.options.form);d.each(function(){b(this);a[imp.attr("name")]=imp.val();imp.attr("disabled","disabled")});var c=this;b.litejsonpost(a,function(a){try{switch(a.code){case "confirm":c.confirm(a.confirmid);break;
case "success":c.success(a);break;default:c.error(a.msg)}}catch(b){form.error(b.message)}}).fail(function(a){c.error(a.responseText)}).always(function(){d.removeAttr("disabled")})},confirm:function(a){var d=this;b.confirmbox(lang.dialog.confirm,lang.comment.checkspam,lang.comment.robot,lang.comment.human,function(c){1==c&&b.litejsonpost({method:"comment_confirm",confirmid:a},d.success).fail(function(a){d.error(a.responseText)})})},success:function(a){if("cookies"in a)for(var b in a.cookies)set_cookie(b,
a.cookies[b]);e.location=a.posturl},submit:function(){try{if(!this.validate())return!1;if(this.options.confirmcomment)return this.send(),!1}catch(a){erralert(a)}}});b(f).ready(function(){litepubl.confirmcomment=new litepubl.class_confirmcomment})})(jQuery,document,window);
