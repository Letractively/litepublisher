class = turlmap
parent = titems
source = lib/urlmap.class.php

Один из центральных классов в litepublisher. В системе всегда доступен экземпляр класса через litepublisher::$urlmap. Назначение класса - обработать http запрос и отдать в браузер контент. Контент берется из кеша или генерируется объектом. Если в кеше не найдено контента, то сопоставляется url запроса с  объектом. Объект создается из данных сопаставления url с именем класса. Получается своеобразная карта url'ов. Все url'ы сайта хранятся в одной таблице.

prop = host
type =string
access = rw

Имя сервера текущего запроса, равно $_SERVER['HTTP_HOST'] в нижнем регистре. Как правило нигде не используется.


prop = url
type = string
access = rw

URL http запроса и равно $_SERVER['REQUEST_URI']. В редких случаях может отличатся от $_SERVER['REQUEST_URI'] чтобы восоздать требуемый запрос, например получить контент какой то страницы.

prop = page
type = int
access = rw

Номер текущей страницы. Нумерация страниц начинается с 1.

prop = uripath
type = array
access = rw

Массив строк полученный разбиениемполного url запроса по символлу /. Используется редко.

prop = itemrequested
type = array
access = rw

Ассоциативный массив с информацией из таблицы урлов. Вот описание ключей и занчений:

- id - уникальный id, целое число
- url - адрес страницы, строка
- class - имя класса, строка
- arg - строка, аргумент для метода request объекта генерирующего контент
- type - тип адреса (url), может принимать следующие значения:
 * normal - обычный адрес, если будет обращение к такому адресу с дополнительными параметрами get запроса (например /my-page.htm?some=val&p=xx), то такой адрес будет переброшен редиректом (в примере /my-page.htm). Такое поведение гарантирует отсутствие дублей страницы со всякими левыми параметрами.
 * get - в адресе могут быть любые get параметры. Это для случаев, когда normal не подходит.
 * tree -подадрес в дереве адресов. Используется редко, например когда известно начало адреса. По друому можно сказать - это вариант get запроса.

prop = context
type = object
access = rw

Объект, который генерирует страницу. По умолчанию null и если для текущего запроса есть кеш, то объект так и не создается.

prop = cachefilename
type = string
access = rw
Имя файла для кеша без пути к нему. Полное имя файла будет если добавить litepublisher::$paths->cache.

prop = argtree
type =string
access = rw

Оставшаяся часть от url, если его тип равен tree. Исползуется редко.

prop = is404
type = boolean
access = rw

Если адрес не был найден, то устанавливается в true

prop = adminpanel
type = boolean
access = rw

Устанавливается в  true, если страница в админке. Адреса админки начинаются с /admin/

prop = mobile
type = boolean
access = rw

true, если запрашивается страница на версии сайта для мобильных устройств

prop = onclose
type = string
access = rw

Массив временных событий, которые буду вызваны после обработки запроса и отдачи контента браузеру.

method = prepareurl
access = protected

Подготавливает url для дальнейшей обработки. Если на сервере нет модуля apache rewrite, то извлекается url из $_GET для дальнейшей работы с ним.


method = request


Центральный метод класса, который очищает url, ищет его в базе и потом отдает контент из кеша или его генерирует.

method = finditem
type = array

Метод ищет url в базе и возвращает ассоциативный массив, который описан в свойстве [[itemrequested]]. Имеет достаточно сложный алгоритм поиска и в случае необходимости делает редирект. Если урл не будет найден возвращает false.

method = findurl
type = array

Метод ищет точное совпадение адреса и возвращает ассоциативный массив, описаный в свойстве [[itemrequested]]. Если урл не будет найден возвращает false.

