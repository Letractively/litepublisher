(function(b,f,g){b(f).ready(function(){litepubl.ulogin=new litepubl.Ulogin});litepubl.Ulogin=Class.extend({registered:!1,script:!1,dialogopened:!1,html:'<div><div style="display:block;overflow:hidden;width:300px;height:50px;"><div id="ulogin-holder" data-ulogin="display=small;fields=first_name,last_name;optional=email,phone,nickname;providers=vkontakte,odnoklassniki,mailru,yandex,facebook,google,twitter;hidden=other;redirect_uri=%%redirurl%%;%%callback%%"></div></div><div><a href="%%url%%">%%lang.emaillogin%%</a></div></div>',
init:function(){this.registered=b.cookie("litepubl_user");this.html=this.html.replace(/%%redirurl%%/gim,encodeURIComponent(ltoptions.url+"/admin/ulogin.php?backurl="));if(!this.registered){var a=this;b('a[href^="'+ltoptions.url+'/admin/"], a[href^="/admin/"]').click(function(){a.open(b(this).attr("href"));return!1});b("#ulogin-comment-button").click(function(){a.open(location.href);return!1})}},open:function(a,e){if(this.dialogopened)return!1;set_cookie("backurl",a);var c=this;c.ready(function(){c.dialogopened=
!0;var d=c.html.replace(/backurl%3D/gim,"backurl%3D"+encodeURIComponent(encodeURIComponent(a))).replace(/%%lang.emaillogin%%/gim,lang.ulogin.emaillogin).replace(/%%url%%/gim,a);b.isFunction(e)?(d=d.replace(/%%callback%%/gim,"callback=ulogincallback"),g.ulogincallback=function(a){b.prettyPhoto.close();try{e(a)}catch(c){erralert(c)}}):d=d.replace(/%%callback%%/gim,"");b.prettyPhotoDialog({title:lang.ulogin.title,html:d,width:300,close:function(){c.dialogopened=false},open:function(){uLogin.customInit("ulogin-holder")},
buttons:[{title:lang.dialog.close,click:b.proxy(b.prettyPhoto.close,b.prettyPhoto)}]})})},ready:function(a){return this.script?this.script.done(a):this.script=b.load_script("http://ulogin.ru/js/ulogin.js",a)},auth:function(a,e,c){var d=this;return b.litejson({method:"ulogin_auth",token:a,callback:e?e:!1},function(a){set_cookie("litepubl_user_id",a.iduser);set_cookie("litepubl_user",a.pass);set_cookie("litepubl_regservice",a.regservice);d.registered=!0;b.isFunction(c)&&(a.callback?c(a.callback):c())})},
login:function(a,b){var c=this;c.open(location.href,function(d){c.auth(d,a,b)})}})})(jQuery,document,window);
