function initdatepicker(a){var b=$("#date").val();$(a).datepicker({altField:"#date",altFormat:"dd.mm.yy",dateFormat:"dd.mm.yy",changeYear:true});$("#datepicker").datepicker("setDate",b)}function loadcontenttabs(){$("#loadcontenttabs").remove();$.get(ltoptions.url+"/admin/ajaxposteditor.htm",{id:ltoptions.idpost,get:"contenttabs"},function(a){$(a).insertBefore("#raweditor");$("#raweditor").appendTo("#rawtab");$("#contenttabs").tabs({cache:true})})}function str_replace(e,d,c){if(!(d instanceof Array)){d=new Array(d);if(e instanceof Array){while(e.length>d.length){d[d.length]=d[0]}}}if(!(e instanceof Array)){e=new Array(e)}while(e.length>d.length){d[d.length]=""}if(c instanceof Array){for(a in c){c[a]=str_replace(e,d,c[a])}return c}for(var a=0;a<e.length;a++){var b=c.indexOf(e[a]);while(b>-1){c=c.replace(e[a],d[a]);b=c.indexOf(e[a],b)}}return c}function addtocurrentfiles(){$("input:checked[id^='itemfilepage']").each(function(){$(this).attr("checked",false);var b=$(this).val();if($("#currentfile-"+b).length==0){var a=str_replace(["pagefile-","pagepost-","itemfilepage-"],["curfile-","curpost-","currentfile-"],$("<div></div>").append($(this).parent().clone()).html());$("#currentfilestab > :first").append(a)}})}function getpostfiles(){var a=[];$("input[id^='currentfile']").each(function(){a.push($(this).val())});return a.join(",")}function initfiletabs(){var a=$.when($.load_script(ltoptions.files+"/js/swfupload/swfupload.js"),$.load_script(ltoptions.files+"/js/litepublisher/swfuploader.min.js"));$.get(ltoptions.url+"/admin/ajaxposteditor.htm",{id:ltoptions.idpost,get:"files"},function(b){$("#filebrowser").html(b);$("#filetabs").tabs({cache:true});$("input[id^='addfilesbutton']").live("click",addtocurrentfiles);$("#deletecurrentfiles").click(function(){$("input:checked[id^='currentfile']").each(function(){$(this).parent().remove()});return false});$("form:first").submit(function(){$("input[name='files']").val(getpostfiles())});a.done(function(){ltoptions.swfu=createswfu()})})}function tagtopost(){var e=$(this).text();var a=$("#text-tags").val();if(a==""){$("#text-tags").val(e)}else{var c=/\s*,\s*/;var d=a.split(c);for(var b=d.length;b>=0;b--){if(e==d[b]){return false}}$("#text-tags").val(a+", "+e)}return false}function error_dialog(a){$("#dialog_error").dialog({autoOpen:true,modal:true,buttons:[{text:"Ok",click:function(){$(this).dialog("close")}}]})}function initposteditor(){$("#tabs").tabs({cache:true,load:function(a,c){var b=$("#datepicker, datepicker",c.panel);if(b.length){$.load_script(ltoptions.files+"/js/jquery/ui-"+$.ui.version+"/jquery.ui.datepicker.min.js",function(){if(ltoptions.lang=="en"){initdatepicker(b)}else{$.load_script(ltoptions.files+"/js/jquery/ui-"+$.ui.version+"/jquery.ui.datepicker-"+ltoptions.lang+".js",function(){initdatepicker(b)})}})}else{$("a[rel='tagtopost']",c.panel).click(tagtopost)}}});$("a[rel~='initfiletabs']").one("click",function(){initfiletabs();return false});$("a[rel~='loadcontenttabs']").one("click",function(){loadcontenttabs();return false});$("form:first").submit(function(){if(""==$("input[name='title']").val()){error_dialog("empty title");return false}})};