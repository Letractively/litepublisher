(function(d,g){g.HTMLUploader=Class.extend({owner:!1,jq:!1,queue:!1,init:function(a){this.owner=a;this.queue=[];var b=this;d(a.tml.htmlfile,a.holder).fileReaderJS({on:{load:function(a,c){b.queue.push(c);1==b.queue.length&&b.start(c)},beforestart:function(){}}})},start:function(){this.queue.length&&this.uploadfile(this.queue[0])},next:function(){this.queue.length&&(this.queue.shift(),this.start(),0==this.queue.length&&(this.jq=!1,this.owner.complete()))},uploadfile:function(a){var b=this.owner;b.before(a);
var e=new FormData;e.append("filedata",a);for(var c in b.postdata)e.append(c,b.postdata[c]);var f=this;this.jq=d.ajax({type:"post",url:b.url,cache:!1,data:e,contentType:!1,processData:!1,success:function(a){b.uploaded(a);f.next()},xhr:function(){var a=d.ajaxSettings.xhr();"upload"in a&&a.upload.addEventListener("progress",function(a){a.lengthComputable&&b.setprogress(a.loaded,a.total)},!1);return a}}).fail(function(a){f.next();b.error(a.responseText)})}})})(jQuery,litepubl,window);
