(function(b){b.confirmcomment=function(f){var d=b.extend({confirmcomment:!0,comuser:!1,form:"#commentform",editor:"#comment"},ltoptions.theme.comments,f),c={get:function(a){return"content"==a?b(d.editor):b("input[name='"+a+"']",d.form)},error:function(a){return b.messagebox(lang.dialog.error,a)},error_field:function(a,b){c.error(b).close=function(){c.get(a).focus()}},empty:function(a){a=c.get(a).val();return""==b.trim(a)},validemail:function(){var a=b.trim(c.get("email").val());return""==a?!1:/^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/.test(a)},
validate:function(){if(""==b.trim(b(d.editor).val()))return c.error_field("content",lang.comment.emptycontent),!1;if(d.comuser){if(c.empty("name"))return c.error_field("name",lang.comment.emptyname),!1;if(!c.validemail())return c.error_field("email",lang.comment.invalidemail),!1}return!0},send:function(){var a={method:"comment_add"},e=b(":input",d.form);e.each(function(){var c=b(this);a[c.attr("name")]=c.val();c.attr("disabled","disabled")});b.litejsontype("post",a,function(a){try{switch(a.code){case "confirm":c.confirm(a.confirmid);
break;case "success":c.success(a);break;default:c.error(a.msg)}}catch(b){c.error(b.message)}}).fail(function(a){c.error(a.responseText)}).always(function(){e.removeAttr("disabled")})},confirm:function(a){b.confirmbox(lang.dialog.confirm,lang.comment.checkspam,lang.comment.robot,lang.comment.human,function(d){1==d&&b.litejsontype("post",{method:"comment_confirm",confirmid:a},c.success).fail(function(a){c.error(a.responseText)})})},success:function(a){if("cookies"in a)for(var b in a.cookies)set_cookie(b,
a.cookies[b]);window.location=a.posturl},submit:function(){try{if(!c.validate())return!1;if(d.confirmcomment)return c.send(),!1}catch(a){alert(a.message)}}};b(d.editor).off("keydown.confirmcomment").on("keydown.confirmcomment",function(a){a.ctrlKey&&(13==a.keyCode||10==a.keyCode)&&b(d.form).submit()});b(d.form).off("submit.confirmcomment").on("submit.confirmcomment",c.submit)};b(document).ready(function(){b.confirmcomment()})})(jQuery);
