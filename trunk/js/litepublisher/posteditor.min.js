(function(b,f){litepubl.Posteditor=Class.extend({init:function(){var a=b("#tabs");if(0!=a.length){var c=this;a.tabs({hide:!0,show:!0,beforeLoad:litepubl.uibefore,beforeActivate:function(a,d){b("#datetime-holder",d.newPanel).length?c.init_datetime_tab(d.newPanel):b("#seo-holder",d.newPanel).length&&c.init_seo_tab(d.newPanel)},load:function(a,d){b(".posteditor-tag",d.panel).click(function(){c.addtag(b(this).text());return!1})}});b("#posteditor-init-raw-tabs").one("click",function(){c.init_raw_tabs();
return!1});b("#posteditor-init-files").one("click.initfiles",function(){litepubl.fileman=new litepubl.Fileman("#posteditor-files");return!1});b("form:first").submit(function(a){var c=b("input[name='title']");if(""==b.trim(c.val()))return a.stopImmediatePropagation(),b.messagebox(lang.dialog.error,lang.posteditor.emptytitle,function(){c.focus()}),!1})}},addtag:function(a){var c=b("#text-tags").val();if(""==c)b("#text-tags").val(a);else{for(var e=c.split(/\s*,\s*/),d=e.length;0<=d;d--)if(a==e[d])return!1;
b("#text-tags").val(c+", "+a)}},init_seo_tab:function(a){a=b("#seo-holder",a);a.replaceWith(a.get(0).firstChild.nodeValue)},init_datetime_tab:function(a){a=b("#datetime-holder",a);a.replaceWith(a.get(0).firstChild.nodeValue);litepubl.calendar.load(function(){var a=b("#text-date").val();b("#datepicker").datepicker({altField:"#text-date",altFormat:"dd.mm.yy",dateFormat:"dd.mm.yy",defaultDate:a,changeYear:!0})})},init_raw_tabs:function(){b("#posteditor-init-raw-tabs").remove();var a=b("#posteditor-raw-holder"),
c=a.get(0).firstChild.nodeValue;b(a.get(0).firstChild).remove();var c=c.replace(/<comment>/gim,'<div class="tab-holder"><\!--').replace(/<\/comment>/gim,"--\></div>"),e=c.indexOf("<div");b("#posteditor-raw").before(c.substring(0,e)).after(c.substring(e));a.tabs({beforeLoad:litepubl.uibefore,beforeActivate:function(a,c){var e=b(".tab-holder",c.newPanel);e.length&&e.replaceWith(e.get(0).firstChild.nodeValue)}})},init_visual_link:function(a,c){b('<a href="#">'+c+"</a>").appendTo("#posteditor-visual").data("url",
a).one("click",function(){b.load_script(b(this).data("url"));b("#posteditor-visual").remove();return!1})}});b(f).ready(function(){try{litepubl.posteditor=new litepubl.Posteditor}catch(a){erralert(a)}})})(jQuery,document,window);
