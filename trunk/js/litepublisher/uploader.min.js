(function(b,c,d){c.Uploader=Class.extend({handler:!1,postdata:!1,random:0,url:"",maxsize:100,mime:!1,types:"*.*",holder:!1,progressbar:!1,htmlprogress:'<div id="progressbar"></div>',idprogress:"#progressbar",init:function(a){a=b.extend({url:(void 0==ltoptions.uploadurl?ltoptions.url:ltoptions.uploadurl)+"/admin/jsonserver.php",holder:"#uploader",maxsize:100,mime:!1,types:"*.*"},a);b.extend(this,a);this.holder=b(a.holder);this.random=b.now();this.items=[];(a=b.cookie("litepubl_user"))||(a=b.cookie("admin"));
this.postdata={litepubl_user:a,litepubl_user_id:b.cookie("litepubl_user_id"),method:"files_upload"};this.handler="FileReader"in d?new c.HTMLUploader(this):new c.FlashUploader(this);this.progressbar=b(this.htmlprogress).appendTo(this.holder).find(this.idprogress)},geturl:function(){return this.url+"?_="+this.random++},setpercent:function(a){this.progressbar.progressbar({value:a})},setprogress:function(a,b){this.setpercent(Math.ceil(100*(a/b)))},hideprogress:function(){this.progressbar.progressbar("destroy")},
error:function(a){b.messagebox(lang.dialog.error,a)},uploaded:function(a){try{"string"==typeof a&&(a=b.parseJSON(a)),this.items.push(a),b(this).trigger({type:"onupload",resp:a})}catch(e){erralert(e)}},addparam:function(a,b){"addparam"in this.handler?this.handler.addparam(a,b):this.postdata[a]=b},addperm:function(){var a=b("#combo-idperm_upload");a.length&&this.addparam("idperm",a.val())},before:function(){this.addperm();b(this).trigger({type:"onbefore",uploader:this})},complete:function(){this.hideprogress();
b(this).trigger({type:"oncomplete",uploader:this,items:this.items});this.items.length=0},onbefore:function(a){b(this).bind("onbefore",a)},onupload:function(a){b(this).bind("onupload",a)},oncomplete:function(a){b(this).bind("oncomplete",a)}})})(jQuery,litepubl,window);
