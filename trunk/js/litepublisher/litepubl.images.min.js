(function(e,h,f){e.LitepublImages=Class.extend({dataname:"modimg",items:!1,activeclass:"img-galery-active",transclass:"img-galery-trans",cursorclass:"cursor-progress",speed:"slow",circle:!1,playnext:!1,default_title:"",lang:"en",facebook_appid:"290433841025058",facebook_closeurl:"/close-window.html",hash_enabled:!0,popover_enabled:!0,is_image:"\\.(jpg|jpeg|png|bmp|webp|svg)$",linkattrs:!1,ratio:4/3,width:"80%",height:!1,minwidth:32,minheight:152,dialog:!1,opened:!1,html:'<div class="modal fade" id="dialog-%%id%%" tabindex="-1" role="dialog" aria-hidden="true" aria-labelledby="modal-title-%%id%%"><div class="modal-dialog modal-galery"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="%%close%%"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="modal-title-%%id%%"></h4></div><div class="modal-body"></div><div class="modal-footer">%%social_buttons%% %%player_buttons%%</div></div></div></div>',
social_buttons:'<a role="button" target="_blank" href="#" class="btn btn-default social-button" data-like="facebook" title="%%lang.facebook%%"><span class="fa fa-facebook"></span> <span class="sr-only">FaceBook</span></a> <a role="button" target="_blank" href="#" class="btn btn-default social-button" data-like="twitter" title="%%lang.twitter%%"><span class="fa fa-twitter"></span> <span class="sr-only">Twitter</span></a> ',player_buttons:'<button type="button" class="btn btn-default player-button" data-action="back" title="%%lang.tipback%%"><span class="fa fa-backward"></span> <span class="sr-only">%%lang.backward%%</span></button> <button type="button" class="btn btn-default player-button" data-action="next" title="%%lang.tipnext%%"><span class="fa fa-forward"></span> <span class="sr-only">%%lang.forward%%</span></button> <button type="button" class="btn btn-default player-button" data-action="stop" title="%%lang.tipstop%%"><span class="fa fa-stop"></span> <span class="sr-only">%%lang.stop%%</span></button> <button type="button" class="btn btn-default player-button" data-action="play" title="%%lang.tipplay%%"><span class="fa fa-play"></span> <span class="sr-only">%%lang.play%%</span></button> ',
img_html:'<img src="%%url%%" class="img-galery" width="%%width%%" height="%%height%%" style="left:%%left%%px" alt="" />',thumb_html:'<a href="#" class="thumbnail" data-index="%%index%%"><img src="%%url%%" /></a>',init:function(b){this.items=[];this.linkattrs=["href","data-image","data-src"];this.is_image=new RegExp(this.is_image,"i");this.default_title=e("title").text();this.onopen=e.Callbacks();this.onclose=e.Callbacks();this.onindex=e.Callbacks();this.onimage=e.Callbacks();this.additems(b);this.hash_enabled&&
this.items.length&&this.openhash()},destroy:function(){this.dialog&&(this.opened?(this.dialog.one("hidden.bs.modal",e.proxy(this.removeDialog,this)),this.close()):this.removeDialog());this.items=[]},removeDialog:function(){if(!this.dialog)return!1;this.dialog.footer.find("button").each(function(){var b=e(this),a=b.data("bs.tooltip");a&&(clearTimeout(a.timeout),"$tip"in a&&a.$tip&&a.$tip.remove());if(b=b.data("bs.popover"))clearTimeout(b.timeout),"$tip"in b&&b.$tip&&b.$tip.remove()});this.dialog.dialog.remove();
this.dialog.style.remove();this.dialog=!1},load:function(b,a){if(!b||b.error)return!1;if(b.ready)return a(b);if("onready"in b)a&&b.onready.push(a);else{b.onready=a?[a]:[];var c=new Image;c.onload=function(){this.onload=this.onerror=null;b.width=this.width;b.height=this.height;b.ready=!0;for(var a=b.onready,c=0;c<a.length;c++)(0,a[c])(b);delete b.onready};c.onerror=function(){this.onload=this.onerror=null;b.error=!0;delete b.onready};c.src=b.url}},extracturl:function(b){for(var a,c=0,d=this.linkattrs.length;c<
d;c++)if((a=b.attr(this.linkattrs[c]))&&this.is_image.test(a))return a;return!1},extracttitle:function(b){var a=b.attr("title")||b.attr("data-title");if(a&&!this.is_image.test(a))return a;a=b.find("img");return a.length&&(a=a.attr("alt")||a.attr("title"))&&!this.is_image.test(a)?a:(a=b.text())&&!this.is_image.test(a)?a:this.default_title},extractthumb:function(b){var a=b.find("img");return a.length?a.attr("src"):(a=b.attr("data-thumb"))&&this.is_image.test(a)?a:(a=b.css("backgroundImage"))?{backgroundImage:a,
backgroundPositionX:b.css("backgroundPositionX"),backgroundPositionY:b.css("backgroundPositionY"),width:b.css("width"),height:b.css("height")}:!1},additems:function(b){var a=this;e(b).each(function(){a.addlink(this)})},addlink:function(b){b=e(b);if(!b.data(this.dataname)){var a=this.extracturl(b);if(a){a={url:a,title:this.extracttitle(b),thumb:this.extractthumb(b),group:b.attr("data-galery")||b.attr("data-group")||b.attr("rel"),width:0,height:0,ready:!1,error:!1,afterevent:!1};this.items.push(a);
b.data(this.dataname,a);var c=this;b.on("click."+this.dataname,function(){var a=e(this);c.popover_enabled&&a.popover("hide");c.open(a.data(c.dataname));return!1}).on("mouseenter.init"+this.dataname+" focus.init"+this.dataname,function(){var a=e(this);a.off(".init"+c.dataname);var b=a.data(c.dataname);c.popover_enabled?c.opened||(b.ready?c.init_popover(a):b.error||(a.addClass(c.loadingcursor),b.afterevent=event.type,a.one(("mouseenter"==event.type?"mouseleave":"blur")+".after"+c.dataname,function(){e(this).removeClass(c.loadingcursor).data(c.dataname).afterevent=
!1}),c.load(b,function(){a.removeClass(c.loadingcursor);c.init_popover(a)}))):b.ready||b.error||c.load(b,!1)})}}},init_popover:function(b){var a=b.data(this.dataname);if(!a||!a.ready)return!1;var c=a.width/a.height;if(1<=c)var d=h.innerHeight||f.documentElement.clientHeight||f.body.clientHeight,d=Math.floor(d/2)-20,e=Math.floor(d*this.ratio);else e=h.innerWidth||f.documentElement.clientWidth||f.body.clientWidth,e=Math.floor(e/2)-20,d=Math.floor(e/this.ratio);a.width<=e&&a.height<=d?(e=a.width,d=a.height):
e/d>c?e=Math.floor(d*c):d=Math.floor(e/c);var g=a.title;this.is_image.test(g)&&(g=this.default_title);b.popover({container:"body",content:'<img src="'+a.url+'" width="'+e+'" height="'+d+'" />',delay:120,html:!0,placement:"auto "+(1<=c?"bottom":"right"),template:'<div class="popover popover-image"><div class="arrow"></div><h3 class="popover-title" style="max-width:'+e+'px;"></h3><div class="popover-content"></div></div>',title:g,trigger:"hover"});a.afterevent&&b.trigger(a.afterevent)},gethash:function(){var b=
location.href,a=b.indexOf("#");return-1==a?!1:decodeURI(b.substring(a+1,b.length))},sethash:function(b){location.hash="!"+this.dataname+"/"+b},openhash:function(){var b=this.gethash();if(!b)return!1;b=b.split("/");if(1>=b.length)return!1;b=parseInt(b[1]);0<=b&&b<this.items.length&&this.items[b].click()},parse:function(b,a){b=b.replace(/%%(\w*)\.(\w*)%%/gim,function(b,d,e,g,f){return d in a&&"object"===typeof a[d]&&e in a[d]?a[d][e]:b});return b.replace(/%%(\w*)%%/gim,function(b,d,e,g){return d in
a?a[d]:b})},getstyle:function(b){var a,c=0,d=0;for(a=b.length-1;0<=a;a--){var e=b[a];if(e.ready)c=Math.max(c,e.width),d=Math.max(d,e.height);else{c=d=0;break}}c&&(c+=this.minwidth,d+=this.minheight);b=this.width;a=this.height;"number"===typeof this.width?(a=this.width,c&&a>c&&(a=c),b=a+"px",this.height?a="number"===typeof this.height?this.height+"px":this.height:(a=Math.min((h.innerHeight||f.documentElement.clientHeight||f.body.clientHeight)-60,Math.floor((a-60)/this.ratio)+this.minheight),d&&a>d&&
(a=d),a+="px")):"string"===typeof this.width&&0<this.width.indexOf("%")&&!this.height&&(a=(h.innerWidth||f.documentElement.clientWidth||f.body.clientWidth)/100,a=Math.floor(Math.min(100-this.minwidth/a,(parseInt(this.width)-this.minwidth/a)/this.ratio+this.minheight/a)),a+="%");c&&(b=b+";max-width:"+c+"px",a=a+";max-height:"+d+"px");return'<style type="text/css">.modal-galery{width:'+b+";height:"+a+"}</style>"},init_dialog:function(b){var a=this.parse(this.html,{thumbnails:this.getthumbnails(b),social_buttons:this.social_buttons,
player_buttons:this.player_buttons}),a=this.parse(a,{id:e.now(),lang:lang.galery,close:lang.dialog.close}),c=e(this.getstyle(b)).appendTo("head:first"),a=e(a).appendTo("body");this.dialog={index:-1,items:b,images:[],dialog:a,title:a.find(".modal-title"),body:a.find(".modal-body"),thumbnails:a.find(".thumbnails"),footer:a.find(".modal-footer"),style:c};this.dialog.images.length=b.length;this.init_social();var d=this;this.dialog.thumbnails.on("click.thumbnail",".thumbnail",function(){d.setindex(e(this).attr("data-index"));
return!1});e(".player-button",this.dialog.footer).tooltip({container:"body",placement:"top"}).on("click.galery",function(){switch(e(this).attr("data-action")){case "next":d.setindex(d.getindex()+1);break;case "back":d.setindex(d.getindex()-1);break;case "play":d.play();break;case "stop":d.stop()}return!1});this.dialog.body.on("click.prevnext","img",function(a){var b=e(this);a.pageX-b.offset().left<b.width()/2?(d.stop(),d.setindex(d.getindex()-1)):(d.stop(),d.setindex(d.getindex()+1));a.preventDefault()});
a.on("shown.bs.modal",function(){d.opened=!0;d.onopen.fire()}).on("hidden.bs.modal",function(){d.opened=!1;d.hash_enabled&&(location.hash="!"+d.dataname);d.onclose.fire()}).modal()},init_social:function(){var b=this;if("poplike"in e.fn)this.dialog.footer.find(".social-button").poplike({network:function(){return e(this).attr("data-like")},url:function(){return b.geturl()},title:function(){return b.gettitle()},placement:"top",lang:this.lang});else this.dialog.footer.find(".social-button").tooltip({container:"body",
placement:"top"}).on("click.like",function(){var a=b.getindex(),c=b.dialog.items[a],a=encodeURIComponent(location.href),d=encodeURIComponent(c.title),k=encodeURIComponent(c.url),c=e(this);switch(c.attr("data-like")){case "facebook":a=b.facebook_appid?"https://www.facebook.com/dialog/feed?app_id="+b.facebook_appid+"&link="+a+"&name="+d+"&picture="+k+"&display=popup&redirect_uri="+b.facebook_closeurl:"https://www.facebook.com/sharer.php?u="+a+"&t="+d;break;case "twitter":a="https://twitter.com/share?lang="+
b.lang+"&url="+a+"&text="+d;break;case "vk":a="http://vk.com/share.php?url="+a;break;case "ok":a="http://www.odnoklassniki.ru/dk?st.cmd=addShare&st.s=1&st._surl="+a+"&st.comments="+d;break;default:return!1}if(c.is("a"))c.attr("href",a),c.attr("target","_blank");else return h.open(a,"_blank"),!1})},close:function(){if(!this.dialog||!this.opened)return!1;this.dialog.footer.find("button").each(function(){var b=e(this),a=b.data("bs.tooltip");a&&a.hide();(b=b.data("bs.popover"))&&b.hide()});this.dialog.dialog.modal("hide")},
open:function(b){if(!b||b.error||this.opened)return!1;this.opened=!0;b.ready||b.error||this.load(b,!1);this.speed=e.fx?e.fx.speeds[this.speed]||this.speed:this.speed;var a=this.getcuritems(b.group);if(this.dialog){var c=this.dialog;c.items=a;c.images=[];c.images.length=a.length;c.body.empty();c.thumbnails.html(this.getthumbnails(a));c.index=-1;this.setindex(this.urlindex(b.url));c.dialog.modal("show")}else this.init_dialog(a),this.setindex(this.urlindex(b.url))},getcuritems:function(b){for(var a=
[],c=0,d=this.items.length;c<d;c++){var e=this.items[c];e.group!=b||e.error||a.push(e)}return a},getthumbnails:function(b){for(var a="",c=0,d=b.length;c<d;c++)a+=this.parse(this.thumb_html,{index:c,url:b[c].url});return a},geturl:function(){return this.dialog.items[this.dialog.index].url},gettitle:function(){return this.dialog.items[this.dialog.index].title},urlindex:function(b){for(var a=this.dialog.items,c=0,d=a.length;c<d;c++)if(b==a[c].url)return c;return!1},getindex:function(){return this.dialog.index},
setindex:function(b){var a=parseInt(b);b=this.dialog.items;0>a&&(a=this.circle?b.length-1:0);a>=b.length&&(a=this.circle?0:b.length-1);if(a==this.dialog.index)return!1;var c=this.dialog.index;this.onindex.fire(a,c);this.dialog.index=a;b=b[a];if(b.ready)this.setimage(a,c);else{var d=this;d.setloading(!0);this.load(b,function(){d.setloading(!1);d.setimage(a,c)})}},setimage:function(b,a){this.dialog.title.text(this.dialog.items[b].title);0<=a?(this.deactivate(a),this.setactive(b)):this.getimage(b).addClass(this.activeclass);
this.preload();this.onimage.fire(b)},getimage:function(b){if(0>b||b>=this.dialog.items.length)return!1;var a=this.dialog.images[b];if(a)return a;var c=this.dialog.items[b],a=this.dialog.body,d=a.width(),f=d,g=this.dialog.body.height();if(c.width<=f&&c.height<=g)f=c.width,g=c.height;else{var h=c.width/c.height;f/g>h?f=Math.floor(g*h):g=Math.floor(f/h)}c=e.simpletml(this.img_html,{url:c.url,width:f,height:g,left:Math.floor((d-f)/2)});return this.dialog.images[b]=e(c).appendTo(a)},deactivate:function(b){var a=
this.dialog.images[b];if(!a)return!1;a.removeClass(this.activeclass);e.support.transition?(a.removeClass(this.transclass),setTimeout(function(){a.addClass("hide")},this.speed)):a.stop(!0,!0).fadeOut(this.speed,function(){e(this).addClass("hide")})},setactive:function(b){b=this.getimage(b);b.removeClass("hide").addClass(this.activeclass);e.support.transition?(b.addClass(this.transclass),setTimeout(e.proxy(this.animated,this),this.speed)):b.stop(!0,!0).fadeIn(this.speed,e.proxy(this.animated,this))},
preload:function(){for(var b=this.dialog.items,a=this.dialog.index+1,c=b.length;a<c;a++){var d=b[a];if(!d.ready&&!d.error){this.load(d,!1);break}}for(a=this.dialog.index-1;0<=a;a--)if(d=b[a],!d.ready&&!d.error){this.load(d,!1);break}},animated:function(){this.playnext&&this.playnext();this.onanimated.fire()},play:function(){if(1>=this.dialog.items.length)return!1;this.circle=!0;var b=this;this.playnext=function(){b.setindex(b.getindex()+1)};this.playnext()},stop:function(){this.playnext=this.circle=
!1}});e(f).ready(function(){e.litepublImages=new e.LitepublImages("a.photo")})})(jQuery,window,document);
