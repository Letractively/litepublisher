(function(e,l,g){e.LitepublImages=Class.extend({dataname:"lpimg",items:!1,activeclass:"img-galery-active",transclass:"img-galery-trans",cursorclass:"cursor-progress",speed:"slow",circle:!1,playnext:!1,default_title:"",lang:"en",facebook_appid:"290433841025058",facebook_closeurl:"/close-window.html",hash_enabled:!0,popover_enabled:!0,is_image:"\\.(jpg|jpeg|png|bmp|webp|svg)$",linkattrs:!1,ratio:4/3,width:"80%",height:!1,dlg_width:32,dlg_height:152,dialog:!1,opened:!1,html:'<div class="modal fade" id="dialog-%%id%%" tabindex="-1" role="dialog" aria-hidden="true" aria-labelledby="modal-title-%%id%%"><div class="modal-dialog modal-galery"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="%%close%%"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="modal-title-%%id%%"></h4></div><div class="modal-body"></div><div class="modal-footer">%%social_buttons%% %%player_buttons%%</div></div></div></div>',
social_buttons:'<a role="button" target="_blank" href="#" class="btn btn-default social-button" data-like="facebook" title="%%lang.facebook%%"><span class="fa fa-facebook"></span> <span class="sr-only">FaceBook</span></a> <a role="button" target="_blank" href="#" class="btn btn-default social-button" data-like="twitter" title="%%lang.twitter%%"><span class="fa fa-twitter"></span> <span class="sr-only">Twitter</span></a> ',player_buttons:'<button type="button" class="btn btn-default player-button" data-action="back" title="%%lang.tipback%%"><span class="fa fa-backward"></span> <span class="sr-only">%%lang.backward%%</span></button> <button type="button" class="btn btn-default player-button" data-action="next" title="%%lang.tipnext%%"><span class="fa fa-forward"></span> <span class="sr-only">%%lang.forward%%</span></button> <button type="button" class="btn btn-default player-button" data-action="stop" title="%%lang.tipstop%%"><span class="fa fa-stop"></span> <span class="sr-only">%%lang.stop%%</span></button> <button type="button" class="btn btn-default player-button" data-action="play" title="%%lang.tipplay%%"><span class="fa fa-play"></span> <span class="sr-only">%%lang.play%%</span></button> ',
img_html:'<img src="%%url%%" class="img-galery" width="%%width%%" height="%%height%%" style="left:%%left%%px" alt="" />',loading_html:'<img src="/js/litepublisher/icons/Preloader_4.gif" width="64" height="64" alt="" />',thumb_html:'<a href="#" class="thumbnail" data-index="%%index%%"><img src="%%url%%" /></a>',style_html:'<style type="text/css">.modal-galery{width:%%dlg_width%%px;height:%%dlg_height%%px}.modal-galery .modal-body{width:%%body_width%%px;height:%%body_height%%px}</style>',init:function(b){this.items=
[];this.linkattrs=["href","data-image","data-src"];this.is_image=new RegExp(this.is_image,"i");this.default_title=e("title").text();this.onopen=e.Callbacks();this.onclose=e.Callbacks();this.onindex=e.Callbacks();this.onimage=e.Callbacks();this.onanimated=e.Callbacks();this.additems(b);this.hash_enabled&&this.items.length&&this.openhash()},destroy:function(){this.dialog&&(this.opened?(this.dialog.one("hidden.bs.modal",e.proxy(this.removeDialog,this)),this.close()):this.removeDialog());this.items=[]},
removeDialog:function(){if(!this.dialog)return!1;this.dialog.footer.find("button").each(function(){var b=e(this),a=b.data("bs.tooltip");a&&(clearTimeout(a.timeout),"$tip"in a&&a.$tip&&a.$tip.remove());if(b=b.data("bs.popover"))clearTimeout(b.timeout),"$tip"in b&&b.$tip&&b.$tip.remove()});this.dialog.dialog.remove();this.dialog.style&&this.dialog.style.remove();this.dialog=!1},load:function(b,a){if(!b||b.error)return!1;if(b.ready)return a(b);if("onready"in b)a&&b.onready.push(a);else{b.onready=a?[a]:
[];var c=new Image;c.onload=function(){this.onload=this.onerror=null;b.width=this.width;b.height=this.height;b.ready=!0;for(var a=b.onready,c=0;c<a.length;c++)(0,a[c])(b);delete b.onready};c.onerror=function(){this.onload=this.onerror=null;b.error=!0;delete b.onready};c.src=b.url}},extracturl:function(b){for(var a,c=0,d=this.linkattrs.length;c<d;c++)if((a=b.attr(this.linkattrs[c]))&&this.is_image.test(a))return a;return!1},extracttitle:function(b){var a=b.attr("title")||b.attr("data-title");if(a&&
!this.is_image.test(a))return a;a=b.find("img");return a.length&&(a=a.attr("alt")||a.attr("title"))&&!this.is_image.test(a)?a:(a=b.text())&&!this.is_image.test(a)?a:this.default_title},extractthumb:function(b){var a=b.find("img");return a.length?a.attr("src"):(a=b.attr("data-thumb"))&&this.is_image.test(a)?a:(a=b.css("backgroundImage"))?{backgroundImage:a,backgroundPositionX:b.css("backgroundPositionX"),backgroundPositionY:b.css("backgroundPositionY"),width:b.css("width"),height:b.css("height")}:
!1},additems:function(b){var a=this;e(b).each(function(){a.addlink(this)})},addlink:function(b){b=e(b);if(!b.data(this.dataname)){var a=this.extracturl(b);if(a){a={url:a,title:this.extracttitle(b),thumb:this.extractthumb(b),group:b.attr("data-galery")||b.attr("data-group")||b.attr("rel"),width:0,height:0,ready:!1,error:!1,afterevent:!1};this.items.push(a);b.data(this.dataname,a);var c=this;b.on("click."+this.dataname,function(){var a=e(this);c.popover_enabled&&a.popover("hide");c.open(a.data(c.dataname));
return!1}).on("mouseenter.init"+this.dataname+" focus.init"+this.dataname,function(){var a=e(this);a.off(".init"+c.dataname);var b=a.data(c.dataname);c.popover_enabled?c.opened||(b.ready?c.init_popover(a):b.error||(a.addClass(c.loadingcursor),b.afterevent=event.type,a.one(("mouseenter"==event.type?"mouseleave":"blur")+".after"+c.dataname,function(){e(this).removeClass(c.loadingcursor).data(c.dataname).afterevent=!1}),c.load(b,function(){a.removeClass(c.loadingcursor);c.init_popover(a)}))):b.ready||
b.error||c.load(b,!1)})}}},init_popover:function(b){var a=b.data(this.dataname);if(!a||!a.ready)return!1;var c=a.width/a.height;if(1<=c)var d=l.innerHeight||g.documentElement.clientHeight||g.body.clientHeight,d=Math.floor(d/2)-20,f=Math.floor(d*this.ratio);else f=l.innerWidth||g.documentElement.clientWidth||g.body.clientWidth,f=Math.floor(f/2)-20,d=Math.floor(f/this.ratio);a.width<=f&&a.height<=d?(f=a.width,d=a.height):f/d>c?f=Math.floor(d*c):d=Math.floor(f/c);var e=a.title;this.is_image.test(e)&&
(e=this.default_title);b.popover({container:"body",content:'<img src="'+a.url+'" width="'+f+'" height="'+d+'" />',delay:120,html:!0,placement:"auto "+(1<=c?"bottom":"right"),template:'<div class="popover popover-image"><div class="arrow"></div><h3 class="popover-title" style="max-width:'+f+'px;"></h3><div class="popover-content"></div></div>',title:e,trigger:"hover"});a.afterevent&&b.trigger(a.afterevent)},gethash:function(){var b=location.href,a=b.indexOf("#");return-1==a?!1:decodeURI(b.substring(a+
1,b.length))},sethash:function(b){location.hash="!"+(this.dialog&&this.dialog.group||this.dataname)+"/"+b},openhash:function(){var b=this.gethash();if(!b)return!1;var a=b.split("/");if(1>=a.length)return!1;b=parseInt(a[1]);if(0>b||b>=this.items.length)return!1;a=a[0];a.length&&"!"==a.substring(0,1)&&(a=a.substring(1,a.length));a=this.getcuritems(a);return b>=a.length?!1:this.open(a[b],a)},parse:function(b,a){b=b.replace(/%%(\w*)\.(\w*)%%/gim,function(b,d,f,e,g){return d in a&&"object"===typeof a[d]&&
f in a[d]?a[d][f]:b});return b.replace(/%%(\w*)%%/gim,function(b,d,f,e){return d in a?a[d]:b})},getstyle:function(b){for(var a,c,d,f=999,n=0,h=0,m=0,p=!0,k=b.length-1;0<=k;k--)if(d=b[k],d.ready)h=Math.max(h,d.width),m=Math.max(m,d.height),d=d.width/d.height,n=Math.max(n,d),f=Math.min(f,d);else{p=!1;break}b=l.innerWidth||g.documentElement.clientWidth||g.body.clientWidth;k=l.innerHeight||g.documentElement.clientHeight||g.body.clientHeight;"number"===typeof this.width?a=this.width:"string"===typeof this.width&&
0<this.width.indexOf("%")&&(a=parseInt(this.width)*b/100);this.height?"number"===typeof this.height?c=this.height:"string"===typeof this.height&&0<this.height.indexOf("%")&&(c=parseInt(this.height)*k/100):c=a*this.ratio;p&&(a>h&&(a=h),n==f&&(c=a/f),c>m&&(c=m));a=Math.floor(Math.min(a,b-this.dlg_width-30));c=Math.floor(Math.min(c,k-this.dlg_height-30));return e.simpletml(this.style_html,{dlg_width:a+this.dlg_width,dlg_height:c+this.dlg_height,body_width:a,body_height:c})},init_dialog:function(b){var a=
this.parse(this.html,{thumbnails:this.getthumbnails(b),social_buttons:this.social_buttons,player_buttons:this.player_buttons}),a=this.parse(a,{id:e.now(),lang:lang.images,close:lang.dialog.close});this.speed=e.fx?e.fx.speeds[this.speed]||this.speed:this.speed;var c=e(this.getstyle(b)).appendTo("head:first"),a=e(a).appendTo("body");this.dialog={index:-1,items:b,images:[],dialog:a,title:a.find(".modal-title"),body:a.find(".modal-body"),thumbnails:a.find(".thumbnails"),footer:a.find(".modal-footer"),
style:c,loading:!1};this.dialog.images.length=b.length;this.init_social();var d=this;this.dialog.thumbnails.on("click.thumbnail",".thumbnail",function(){d.setindex(e(this).attr("data-index"));return!1});e(".player-button",this.dialog.footer).tooltip({container:"body",placement:"top"}).on("click.galery",function(){var a=e(this);switch(a.attr("data-action")){case "next":case "back":d.stop();a.parent().find("[data-action='play']").prop("disabled",!1);a.parent().find("[data-action='stop']").prop("disabled",
!0);d.setindex(d.getindex()+("next"==a.attr("data-action")?1:-1));break;case "play":a.prop("disabled",!0);a.parent().find("[data-action='stop']").prop("disabled",!1);d.play();break;case "stop":a.prop("disabled",!0),a.parent().find("[data-action='play']").prop("disabled",!1),d.stop()}return!1});this.dialog.body.on("click.prevnext","img",function(a){var b=e(this);a.pageX-b.offset().left<b.width()/2?(d.stop(),d.setindex(d.getindex()-1)):(d.stop(),d.setindex(d.getindex()+1));a.preventDefault()});a.on("shown.bs.modal",
function(){d.opened=!0;d.onopen.fire()}).on("hide.bs.modal",e.proxy(this.doclose,this)).on("hidden.bs.modal",e.proxy(this.doclosed,this)).modal()},init_social:function(){var b=this;if("poplike"in e.fn)this.dialog.footer.find(".social-button").poplike({network:function(){return e(this).attr("data-like")},url:function(){return b.geturl()},title:function(){return b.gettitle()},placement:"top",lang:this.lang});else this.dialog.footer.find(".social-button").tooltip({container:"body",placement:"top"}).on("click.like",
function(){var a=b.getindex(),c=b.dialog.items[a],a=encodeURIComponent(location.href),d=encodeURIComponent(c.title),f=encodeURIComponent(c.url),c=e(this);switch(c.attr("data-like")){case "facebook":a=b.facebook_appid?"https://www.facebook.com/dialog/feed?app_id="+b.facebook_appid+"&link="+a+"&name="+d+"&picture="+f+"&display=popup&redirect_uri="+b.facebook_closeurl:"https://www.facebook.com/sharer.php?u="+a+"&t="+d;break;case "twitter":a="https://twitter.com/share?lang="+b.lang+"&url="+a+"&text="+
d;break;case "vk":a="http://vk.com/share.php?url="+a;break;case "ok":a="http://www.odnoklassniki.ru/dk?st.cmd=addShare&st.s=1&st._surl="+a+"&st.comments="+d;break;default:return!1}if(c.is("a"))c.prop("href",a),c.prop("target","_blank");else return l.open(a,"_blank"),!1})},close:function(){if(!this.dialog||!this.opened)return!1;this.dialog.dialog.modal("hide")},doclose:function(){if(!this.dialog||!this.opened)return!1;this.opened=!1;this.stop();this.dialog.footer.find("button").each(function(){var b=
e(this),a=b.data("bs.tooltip");a&&a.hide();(b=b.data("bs.popover"))&&b.hide()})},doclosed:function(){this.hash_enabled&&(location.hash="!"+this.dataname);this.dialog.style.remove();this.dialog.style=!1;this.onclose.fire()},open:function(b,a){if(!b||b.error||this.opened)return!1;this.opened=!0;b.ready||b.error||this.load(b,!1);a||(a=this.getcuritems(b.group));if(this.dialog){var c=this.dialog;c.items=a;c.images=[];c.images.length=a.length;c.body.empty();c.thumbnails.html(this.getthumbnails(a));c.style=
e(this.getstyle(a)).appendTo("head:first");c.index=-1;this.setindex(this.urlindex(b.url));c.dialog.modal("show")}else this.init_dialog(a),this.setindex(this.urlindex(b.url))},getcuritems:function(b){for(var a=[],c=0,d=this.items.length;c<d;c++){var e=this.items[c];e.error||(e.group==b||!e.group&&b==this.dataname||!b&&e.group==this.dataname)&&a.push(e)}return a},getthumbnails:function(b){for(var a="",c=0,d=b.length;c<d;c++)a+=this.parse(this.thumb_html,{index:c,url:b[c].url});return a},geturl:function(){return this.dialog.items[this.dialog.index].url},
gettitle:function(){return this.dialog.items[this.dialog.index].title},urlindex:function(b){for(var a=this.dialog.items,c=0,d=a.length;c<d;c++)if(b==a[c].url)return c;return!1},getindex:function(){return this.dialog.index},setindex:function(b){var a=parseInt(b);b=this.dialog.items;0>a&&(a=this.circle?b.length-1:0);a>=b.length&&(a=this.circle?0:b.length-1);if(a==this.dialog.index)return!1;var c=this.dialog.index;this.onindex.fire(a,c);this.dialog.index=a;var d=b[a];if(d.ready)this.setimage(a,c);else{var e=
this;this.load(d,function(){e.opened&&e.setimage(a,c)});setTimeout(function(){!d.ready&&e.opened&&e.showloading()},60)}},setimage:function(b,a){this.hideloading();this.dialog.title.text(this.dialog.items[b].title);if(0<=a)this.deactivate(this.dialog.images[a]),this.activate(this.getimage(b),e.proxy(this.animated,this));else{var c=this.getimage(b);c&&c.removeClass("hide").addClass(this.activeclass)}this.hash_enabled&&this.sethash(b);this.preload();this.onimage.fire(b)},getimage:function(b){if(0>b||
b>=this.dialog.items.length)return!1;var a=this.dialog.images[b];if(a)return a;var c=this.dialog.items[b];if(!c.ready)return!1;var a=this.dialog.body,d=a.width(),f=d,g=this.dialog.body.height();if(c.width<=f&&c.height<=g)f=c.width,g=c.height;else{var h=c.width/c.height;f/g>h?f=Math.floor(g*h):g=Math.floor(f/h)}c=e.simpletml(this.img_html,{url:c.url,width:f,height:g,left:Math.floor((d-f)/2)});return this.dialog.images[b]=e(c).appendTo(a)},deactivate:function(b,a){if(!b)return!1;b.removeClass(this.activeclass);
e.support.transition?(b.removeClass(this.transclass),setTimeout(function(){b.addClass("hide")},this.speed)):b.stop(!0,!0).fadeOut(this.speed,function(){e(this).addClass("hide")})},activate:function(b,a){if(!b)return!1;b.removeClass("hide").addClass(this.activeclass);e.support.transition?(b.addClass(this.transclass),a&&setTimeout(a,this.speed)):b.stop(!0,!0).fadeIn(this.speed,a)},preload:function(){for(var b=this.dialog.items,a=this.dialog.index+1,c=b.length;a<c;a++){var d=b[a];if(!d.ready&&!d.error){this.load(d,
!1);break}}for(a=this.dialog.index-1;0<=a;a--)if(d=b[a],!d.ready&&!d.error){this.load(d,!1);break}},animated:function(){this.onanimated.fire();this.opened&&this.playnext&&setTimeout(this.playnext,60)},playindex:function(){this.opened&&this.setindex(this.getindex()+1)},play:function(){if(1>=this.dialog.items.length)return!1;this.circle=!0;this.playnext=e.proxy(this.playindex,this);this.playnext()},stop:function(){this.playnext=this.circle=!1},showloading:function(){var b=this.dialog.loading;if(!b){var a=
this.dialog.body,b=this.dialog.loading=e(this.loading_html).appendTo(a);b.css({left:Math.floor((a.width()-b.attr("width"))/2),top:Math.floor((a.height()-b.attr("height"))/2)})}b.hasClass("hide")&&b.removeClass("hide")},hideloading:function(){var b=this.dialog.loading;b&&!b.hasClass("hide")&&b.addClass("hide")}});e(g).ready(function(){e.litepublImages=new e.LitepublImages("a.photo")})})(jQuery,window,document);
