(function(k,p,m){k.fn.popimage=function(g){g=k.extend({title:"",cursorclass:"cursor-loading",width:!1,height:!1},g);var a=!1,n=/\.(jpg|jpeg|png|bmp)$/i,q,r;return this.each(function(){var h=k(this),l=h.attr("href");l||(l=h.data("image"));l&&n.test(l)&&(h.data("image",l),a&&(h.data("prevlink",a),a.data("nextlink",h)),a=h,h.one("mouseenter.popinit focus.popinit click.popinit",function(a){var b=k(this);b.off(".popinit");b.addClass(g.cursorclass);if(n.test(b.attr("href")))var s=" click";else{if("click"==
a.type)return;s=""}b.data("focused",a.type).on(("mouseenter"==a.type?"mouseleave":"blur")+".popinit",function(){k(this).data("focused",!1).off(".popinit")});var e=new Image;e.onload=function(){b.removeClass(g.cursorclass);var f=e.width/e.height;if(g.width)var c=g.width,d=g.height;else 1<=f?(d=p.innerHeight||m.documentElement.clientHeight||m.body.clientHeight,d=Math.floor(d/2)-20,c=Math.floor(4*d/3)):(c=p.innerWidth||m.documentElement.clientWidth||m.body.clientWidth,c=Math.floor(c/2)-20,d=Math.floor(c/
4*3));e.width<=c&&e.height<=d?(c=e.width,d=e.height):c/d>f?c=Math.floor(d*f):d=Math.floor(c/f);var a=b.attr("title");n.test(a)&&(a=g.title);b.popover({container:"body",content:'<img src="'+l+'" width="'+c+'" height="'+d+'" />',delay:120,html:!0,placement:"auto "+(1<=f?"bottom":"right"),template:'<div class="popover popover-image"><div class="arrow"></div><h3 class="popover-title" style="max-width:'+c+'px;"></h3><div class="popover-content"></div></div>',title:a,trigger:"hover focus"+s});b.data("focused")&&
b.trigger(b.data("focused"));if(f=b.data("nextlink"))q=new Image,q.src=f.data("image");if(f=h.data("prevlink"))r=new Image,r.src=f.data("image")};e.onerror=function(){};e.src=b.data("image");return!1}))})};ready2(function(){"popover"in k.fn&&k("a.photo").popimage()})})(jQuery,window,document);
