(function(a){a.moderate=function(b){var c={enabled:true,options:{comments:"#commentlist",hold:"#holdcommentlist",comment:"#comment-",content:"#commentcontent-",buttons:".moderationbuttons",button:'<button type="button">%%title%%</button>',form:"#commentform",editor:"#comment"},setenabled:function(d){if(d==this.enabled){return}this.enabled=d;if(d){a(c.options.buttons).show()}else{a(c.options.buttons).hide()}},click:function(){if(!c.enabled){return false}try{var d=a(this);var f=d.data("moder");var h=d.data("idcomment");c.setstatus(h,f)}catch(g){alert("error "+g.message)}return false},error:function(d){c.setenabled(true);a.messagebox(lang.dialog.error,d)},setstatus:function(g,e){var f=c.options;var d=f.comment+g;switch(e){case"delete":c.setenabled(false);a.confirmbox(lang.dialog.confirm,lang.comments.confirmdelete,lang.comments.yesdelete,lang.comments.nodelete,function(h){if(h!=0){return c.setenabled(true)}a.litejson({method:"comment_delete",id:g},function(i){if(i==false){return c.error(lang.comments.notdeleted)}a(d).remove();c.setenabled(true)}).fail(function(k,j,i){c.error(lang.comments.notdeleted)})});break;case"hold":case"approved":c.setenabled(false);a.litejson({method:"comment_setstatus",id:g,status:e},function(h){try{if(h==false){return c.error(lang.comments.notmoderated)}a(e=="hold"?f.hold:f.comments).append(a(f.comment+g));c.setenabled(true)}catch(i){alert("error "+i.message)}}).fail(function(j,i,h){c.error(lang.comments.notmoderated)});break;case"edit":c.setenabled(false);a.litejson({method:"comment_getraw",id:g},function(j){var i=a(c.options.editor);i.data("idcomment",g);i.data("savedtext",i.val());i.val(j.rawcontent);i.focus();a.onEscape(c.restore_submit);var h=a(f.form);h.off("submit.confirmcomment").on("submit.moderate",function(){try{var l=a(f.editor);var k=a.trim(l.val());if(k==""){c.enabled=true;c.error(lang.comment.emptycontent);c.enabled=false;return false}a(":input",h).attr("disabled","disabled");a.litejsontype("post",{method:"comment_edit",id:l.data("idcomment"),content:k},function(n){try{a(":input",h).removeAttr("disabled");var p=f.content+n.id;a(p).html(n.content);c.restore_submit();location.hash=p.substring(1)}catch(o){alert(o.message)}}).fail(function(p,o,n){a(":input",h).removeAttr("disabled");c.error(lang.comments.notedited);c.restore_submit()})}catch(m){alert(m.message)}return false})}).fail(function(j,i,h){c.error(lang.comments.errorrecieved)});break;default:alert("Unknown status "+e)}},restore_submit:function(){var d=a(c.options.editor);d.val(d.data("savedtext"));a(c.options.form).off("submit.moderate");c.setenabled(true);if("confirmcomment" in a){a.confirmcomment()}},loadhold:function(){a(".loadhold").parent().remove();a.litejson({method:"comments_get_hold",idpost:ltoptions.idpost},function(f){try{var d=c.options;if(d.ismoder){var g=a(d.comments);var i=a(d.hold);while(g.next()[0]!=i[0]){g.next().remove()}i.remove()}a(d.comments).after(f.items);c.create_buttons(d.hold)}catch(h){alert("error "+h.message)}}).fail(function(f,e,d){c.error(lang.comments.errorrecieved)});return false},create_buttons:function(e){var l=c.options;var k=l.button.replace("%%title%%",lang.comments.approve);var d=l.button.replace("%%title%%",lang.comments.hold);var j=l.button.replace("%%title%%",lang.comments.del);var g=l.button.replace("%%title%%",lang.comments.edit);var h='<button type="button">E</button>';var f=c.click;var i=get_cookie("litepubl_user_id");a(l.buttons,e).each(function(){var m=a(this);var o=m.data("idcomment");if(l.ismoder){a(k).appendTo(m).data("idcomment",o).data("moder","approved").click(f);a(d).appendTo(m).data("idcomment",o).data("moder","hold").click(f);a(j).appendTo(m).data("idcomment",o).data("moder","delete").click(f);a(g).appendTo(m).data("idcomment",o).data("moder","edit").click(f);if(m.is(":hidden")){a(h).insertBefore(m).one("click",function(){a(this).next().show();a(this).remove();return false})}}else{var n=m.data("idauthor");if(n==i){if(l.canedit){a(g).appendTo(m).data("idcomment",o).data("moder","edit").click(f)}if(l.candelete){a(j).appendTo(m).data("idcomment",o).data("moder","delete").click(f)}if((l.canedit||l.candelete)&&m.is(":hidden")){a(h).insertBefore(m).one("click",function(){a(this).next().show();a(this).remove();return false})}}}})}};c.options=a.extend(c.options,ltoptions.theme.comments,b);c.create_buttons(c.options.comments+", "+c.options.hold);a(".loadhold").click(c.loadhold);return this};a(document).ready(function(){if(get_cookie("litepubl_user_id")){a.moderate()}})})(jQuery);